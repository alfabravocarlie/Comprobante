<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Comprobantes</title>
    <style>
        /* --- ESTILOS CSS --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 20px;
        }

        header {
            text-align: center;
            background-color: #075E54; /* Color verde oscuro de WhatsApp */
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        header h1 {
            margin: 0;
            font-size: 2em;
        }

        .container {
            display: flex;
            gap: 25px;
            max-width: 1200px;
            margin: 0 auto;
            flex-wrap: wrap; /* Para que se adapte a pantallas peque√±as */
        }

        .input-panel, .detail-panel {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            flex: 1;
            min-width: 300px; /* Ancho m√≠nimo para que no se apriete demasiado */
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box; /* Importante para que el padding no afecte el ancho total */
            font-size: 16px;
        }

        button {
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        #agregar-btn {
            background-color: #3498db;
        }
        #agregar-btn:hover {
            background-color: #2980b9;
        }
        
        #compartir-btn {
            background-color: #25D366; /* Color verde de WhatsApp */
        }
        #compartir-btn:hover {
            background-color: #128C7E;
        }

        #limpiar-btn {
            background-color: #dc3545;
        }
        #limpiar-btn:hover {
            background-color: #c82333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
            font-weight: 600;
        }

        .total-label {
            font-weight: bold;
            text-align: right;
        }

        #total-cell {
            font-weight: bold;
            font-size: 1.2em;
            color: #075E54;
        }

        #detalle-tbody {
            max-height: 300px;
            overflow-y: auto;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .action-buttons button {
            flex: 1;
        }

    </style>
</head>
<body>

    <header>
        <h1>üìÑ Generador de Comprobantes</h1>
        <p>Para compartir por WhatsApp</p>
    </header>

    <main class="container">
        <section class="input-panel">
            <h2>Nueva Venta</h2>
            <div class="form-group">
                <label for="nombre-cliente">Nombre del Cliente:</label>
                <input type="text" id="nombre-cliente" placeholder="Ej: Ana Garc√≠a">
            </div>
            
            <div class="form-group">
                <label for="servicio-select">Seleccionar Servicio:</label>
                <select id="servicio-select">
                    <!-- Las opciones se llenar√°n con JavaScript -->
                </select>
            </div>

            <div class="form-group">
                <label for="cantidad-input">Cantidad:</label>
                <input type="number" id="cantidad-input" value="1" min="1">
            </div>

            <button id="agregar-btn">‚ûï Agregar al Detalle</button>
        </section>

        <section class="detail-panel">
            <h2>Detalle de la Venta</h2>
            <table>
                <thead>
                    <tr>
                        <th>Servicio</th>
                        <th>Cantidad</th>
                        <th>Precio Unitario</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody id="detalle-tbody">
                    <!-- Las filas se agregar√°n con JavaScript -->
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="3" class="total-label">Total a Pagar:</td>
                        <td id="total-cell">$0.00</td>
                    </tr>
                </tfoot>
            </table>
            <div class="action-buttons">
                <button id="compartir-btn">üì§ Compartir Comprobante</button>
                <button id="limpiar-btn">üóëÔ∏è Limpiar Todo</button>
            </div>
        </section>
    </main>

    <script>
        // --- C√ìDIGO JAVASCRIPT ---
        document.addEventListener('DOMContentLoaded', () => {
            // --- CAT√ÅLOGO DE SERVICIOS ---
            const servicios = [
                { nombre: 'Texto B/N', precio: 20 },
                { nombre: 'Texto a Color', precio: 30 },
                { nombre: 'Impresi√≥n de Im√°genes B/N', precio: 50 },
                { nombre: 'Impresi√≥n de Im√°genes a Color', precio: 60 },
                { nombre: 'Edici√≥n Simple', precio: 100 },
                { nombre: 'Edici√≥n Compleja', precio: 200 },
                { nombre: 'Fotocopias B/N', precio: 50 },
                { nombre: 'Fotocopias a Color', precio: 60 },
                { nombre: 'Plasticado Carnet Chiquito', precio: 200 },
                { nombre: 'Plasticado Mitad de Hoja Carta', precio: 300 },
                { nombre: 'Domicilio', precio: 100 }
                
            ];

            // --- VARIABLES DE ESTADO ---
            let carrito = [];
            let total = 0;

            // --- REFERENCIAS A ELEMENTOS DEL DOM ---
            const nombreClienteInput = document.getElementById('nombre-cliente');
            const servicioSelect = document.getElementById('servicio-select');
            const cantidadInput = document.getElementById('cantidad-input');
            const agregarBtn = document.getElementById('agregar-btn');
            const detalleTbody = document.getElementById('detalle-tbody');
            const totalCell = document.getElementById('total-cell');
            const compartirBtn = document.getElementById('compartir-btn');
            const limpiarBtn = document.getElementById('limpiar-btn');

            // --- FUNCIONES ---

            // 1. Llenar el <select> con los servicios del cat√°logo
            function populateServiceDropdown() {
                servicios.forEach(servicio => {
                    const option = document.createElement('option');
                    option.value = servicio.nombre;
                    option.textContent = `${servicio.nombre} - $${servicio.precio.toFixed(2)}`;
                    option.dataset.precio = servicio.precio;
                    servicioSelect.appendChild(option);
                });
            }

            // 2. Agregar un servicio al detalle de la venta
            function agregarAlDetalle() {
                const nombreServicio = servicioSelect.value;
                const precioUnitario = parseFloat(servicioSelect.options[servicioSelect.selectedIndex].dataset.precio);
                const cantidad = parseInt(cantidadInput.value);

                if (!nombreServicio || cantidad <= 0) {
                    alert('Por favor, selecciona un servicio y una cantidad v√°lida.');
                    return;
                }

                const subtotal = precioUnitario * cantidad;
                
                carrito.push({ nombre: nombreServicio, cantidad, precioUnitario, subtotal });
                
                actualizarDetalleHTML();
                calcularTotal();
                
                cantidadInput.value = 1;
            }

            // 3. Actualizar la tabla HTML del detalle
            function actualizarDetalleHTML() {
                detalleTbody.innerHTML = '';
                carrito.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.nombre}</td>
                        <td>${item.cantidad}</td>
                        <td>$${item.precioUnitario.toFixed(2)}</td>
                        <td>$${item.subtotal.toFixed(2)}</td>
                    `;
                    detalleTbody.appendChild(row);
                });
            }

            // 4. Calcular y mostrar el total de la venta
            function calcularTotal() {
                total = carrito.reduce((acc, item) => acc + item.subtotal, 0);
                totalCell.textContent = `$${total.toFixed(2)}`;
            }
            
            // 5. Generar el texto del comprobante y usar la API de Compartir o Copiar
            async function compartirComprobante() {
                const nombreCliente = nombreClienteInput.value || 'Cliente no especificado';
                const fecha = new Date().toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' });

                if (carrito.length === 0) {
                    alert('El detalle de la venta est√° vac√≠o. Agrega servicios antes de compartir.');
                    return;
                }

                // Formateamos el mensaje
                let mensaje = `--- *COMPROBANTE DE PAGO* ---\n\n`;
                mensaje += `*Servicios de Impresi√≥n y Fotocopiado*\n\n`;
                mensaje += `*Cliente:* ${nombreCliente}\n`;
                mensaje += `*Fecha:* ${fecha}\n`;
                mensaje += `---------------------------------\n`;
                mensaje += `*Detalle de Servicios:*\n`;

                carrito.forEach(item => {
                    mensaje += `- ${item.nombre} (x${item.cantidad}) ..... $${item.subtotal.toFixed(2)}\n`;
                });

                mensaje += `---------------------------------\n`;
                mensaje += `*TOTAL A PAGAR: $${total.toFixed(2)}*\n`;
                mensaje += `---------------------------------\n`;
                mensaje += `¬°Gracias por su preferencia!`;

                // --- L√ìGICA DE COMPARTIR ---
                const shareData = {
                    title: 'Comprobante de Pago',
                    text: mensaje
                };

                try {
                    // 1. Prioridad: Usar la API de Compartir nativa (mejor en m√≥viles)
                    if (navigator.share) {
                        await navigator.share(shareData);
                        console.log('Compartido con √©xito');
                    } 
                    // 2. Alternativa: Copiar al portapapeles (funciona en casi todos lados)
                    else if (navigator.clipboard) {
                        await navigator.clipboard.writeText(mensaje);
                        alert('¬°Comprobante copiado al portapapeles!\n\nAhora solo tienes que abrir WhatsApp y pegar el mensaje en el chat del cliente.');
                    }
                    // 3. √öltimo recurso (muy raro): Mostrar en una ventana emergente
                    else {
                        window.open(`data:text/plain;charset=utf-8,${encodeURIComponent(mensaje)}`, '_blank');
                    }
                } catch (err) {
                    console.error('Error al compartir:', err);
                    // El usuario puede haber cancelado la acci√≥n, no mostramos un error molesto.
                }
            }

            // 6. Limpiar toda la venta para empezar una nueva
            function limpiarVenta() {
                if (confirm('¬øEst√°s seguro de que quieres limpiar todo el detalle?')) {
                    carrito = [];
                    total = 0;
                    nombreClienteInput.value = '';
                    cantidadInput.value = 1;
                    servicioSelect.selectedIndex = 0;
                    actualizarDetalleHTML();
                    calcularTotal();
                }
            }

            // --- EVENT LISTENERS ---
            agregarBtn.addEventListener('click', agregarAlDetalle);
            compartirBtn.addEventListener('click', compartirComprobante);
            limpiarBtn.addEventListener('click', limpiarVenta);

            // --- INICIALIZACI√ìN ---
            populateServiceDropdown();
        });
    </script>
</body>

</html>
